<!DOCTYPE html>
<script src="https://unpkg.com/@simplewebauthn/browser/dist/bundle/index.umd.min.js"></script>
<body>
  <h1>SimpleWebAuthn Example</h1>
  <label for="username">Username:</label><br>
  <input type="text" id="username"><br>
  <button type="submit" id="btnBegin">Submit</button>
  <p id="success"></p>
  <p id="error"></p>
</body>
<script>
  const { startRegistration } = SimpleWebAuthnBrowser;

  const elemBegin = document.getElementById('btnBegin');
  const elemSuccess = document.getElementById('success');
  const elemError = document.getElementById('error');
  const username = document.getElementById('username');;

  elemBegin.addEventListener('click', async () => {
    elemSuccess.innerHTML = '';
    elemError.innerHTML = '';
    
    const resp = await fetch('/attestation/options',{
      method: 'POST',
      credentials : 'same-origin',
      headers : {
            'Content-Type' : 'application/json'
        },
      body: JSON.stringify({
        username: username.value
      })
    });

    let attResp;
    try {
      // Pass the options to the authenticator and wait for a response
      attResp = await startRegistration(await resp.json());
    } catch (error) {
      // Some basic error handling
      if (error.name === 'InvalidStateError') {
        elemError.innerText = 'Error: Authenticator was probably already registered by user';
      } else {
        elemError.innerText = error;
      }
      throw error;
    }
    console.log(attResp);
  });


</script>
</html>